---

title: Web interface `s4_design_sim_tool`

keywords: fastai
sidebar: home_sidebar

summary: "Interactive web-based user interface for the CMB-S4 reference simulation tool"
description: "Interactive web-based user interface for the CMB-S4 reference simulation tool"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_ui.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If your browser doesn't visualize the widget input boxes, try reloading the page and <strong>disable your adblocker</strong>.</p>
<p>For support requests, <a href="https://github.com/CMB-S4/s4_design_sim_tool/issues">open an issue on the <code>s4_design_sim_tool</code> repository</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">emission</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;foreground_emission&quot;</span><span class="p">,</span> <span class="s2">&quot;CMB_unlensed&quot;</span><span class="p">,</span> <span class="s2">&quot;CMB_lensing_signal&quot;</span><span class="p">]:</span>
    <span class="n">w</span><span class="p">[</span><span class="n">emission</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Weight:&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">emission</span> <span class="o">=</span> <span class="s2">&quot;CMB_tensor_to_scalar_ratio&quot;</span>
<span class="n">w</span><span class="p">[</span><span class="n">emission</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">f</span><span class="s1">&#39;r:&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sky-emission-weighting">Sky emission weighting<a class="anchor-link" href="#Sky-emission-weighting"> </a></h2><p>Each sky emission has a weighting factor between 0 and 1</p>
<h3 id="Foreground-emission">Foreground emission<a class="anchor-link" href="#Foreground-emission"> </a></h3><p>Synchrotron, Dust, Free-free, AME
Websky CIB, tSZ, kSZ</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;foreground_emission&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Unlensed-CMB">Unlensed CMB<a class="anchor-link" href="#Unlensed-CMB"> </a></h3><p>Planck cosmological parameters, no tensor modes</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;CMB_unlensed&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CMB-lensing-signal">CMB lensing signal<a class="anchor-link" href="#CMB-lensing-signal"> </a></h3><p>CMB lensed - CMB unlensed:</p>
<ul>
<li>1 for lensed CMB</li>
<li>0 for unlensed CMB</li>
<li><code>&gt;0, &lt;1</code> for residual after de-lensing</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;CMB_lensing_signal&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CMB-tensor-to-scalar-ratio">CMB tensor to scalar ratio<a class="anchor-link" href="#CMB-tensor-to-scalar-ratio"> </a></h3><p>Value of the <code>r</code> cosmological parameter</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;CMB_tensor_to_scalar_ratio&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Experiment-parameters">Experiment parameters<a class="anchor-link" href="#Experiment-parameters"> </a></h2><h3 id="Total-experiment-length">Total experiment length<a class="anchor-link" href="#Total-experiment-length"> </a></h3><p>In years, supports decimals</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;total_experiment_length_years&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Years:&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;total_experiment_length_years&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;observing_efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Efficiency:&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Observing-efficiency">Observing efficiency<a class="anchor-link" href="#Observing-efficiency"> </a></h3><p>Typically 20%, use decimal notation</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;observing_efficiency&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;number_of_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Splits:&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Number-of-splits">Number of splits<a class="anchor-link" href="#Number-of-splits"> </a></h3><p>Number of splits, 1 generates only full mission
2-7 generates the full mission map and then the requested number
of splits scaled accordingly. E.g. 7 generates the full mission
map and 7 equal (yearly) maps</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;number_of_splits&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Telescope-configuration">Telescope configuration<a class="anchor-link" href="#Telescope-configuration"> </a></h2><p>Currently we constraint to have a total of 6 SAT and 3 LAT,
each SAT has a maximum of 3 tubes, each LAT of 19.
The checkbox on the right of each telescope checks that the amount of number of tubes is correct.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">toml</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;s4_reference_design.toml&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">define_check_sum</span><span class="p">(</span><span class="n">telescope_widgets</span><span class="p">,</span> <span class="n">max_tubes</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">check_sum</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="n">total_tubes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">telescope_widgets</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="p">]])</span>
        <span class="n">telescope_widgets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">total_tubes</span> <span class="o">==</span> <span class="n">max_tubes</span>
    <span class="k">return</span> <span class="n">check_sum</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">telescopes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SAT&quot;</span><span class="p">:{},</span> <span class="s2">&quot;LAT&quot;</span><span class="p">:{}}</span>
<span class="k">for</span> <span class="n">telescope</span><span class="p">,</span> <span class="n">tubes</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">][</span><span class="s2">&quot;SAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;SAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Valid</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">telescope</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;120px&#39;</span><span class="p">)</span>
    <span class="p">)]</span>
    <span class="n">telescope_check</span> <span class="o">=</span> <span class="n">define_check_sum</span><span class="p">(</span><span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;SAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tubes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span>
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pole&#39;</span><span class="p">,</span> <span class="s1">&#39;Chile&#39;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;150px&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;years&quot;</span><span class="p">:</span>
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;years&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;130px&#39;</span><span class="p">)</span>
    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;130px&#39;</span><span class="p">)</span>
            <span class="p">)</span> 
            <span class="n">wid</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">telescope_check</span><span class="p">)</span>
        <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;SAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;SAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">telescope</span><span class="p">,</span> <span class="n">tubes</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">][</span><span class="s2">&quot;LAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;LAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Valid</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">telescope</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;120px&#39;</span><span class="p">)</span>
    <span class="p">)]</span>
    <span class="n">telescope_check</span> <span class="o">=</span> <span class="n">define_check_sum</span><span class="p">(</span><span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;LAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">],</span> <span class="mi">19</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tubes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;site&quot;</span><span class="p">:</span>
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pole&#39;</span><span class="p">,</span> <span class="s1">&#39;Chile&#39;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;150px&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;years&quot;</span><span class="p">:</span>
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;years&#39;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;130px&#39;</span><span class="p">)</span>
    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">wid</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
    <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;130px&#39;</span><span class="p">)</span>
            <span class="p">)</span> 
            <span class="n">wid</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">telescope_check</span><span class="p">)</span>
        <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;LAT&quot;</span><span class="p">][</span><span class="n">telescope</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">telescopes</span><span class="p">[</span><span class="s2">&quot;LAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">toml</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">toml_decoder</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">TomlDecoder</span><span class="p">()</span>
<span class="n">toml_encoder</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">TomlPreserveInlineDictEncoder</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">generate_toml</span><span class="p">():</span>
    <span class="n">output_config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sky_emission&quot;</span><span class="p">,</span> <span class="s2">&quot;experiment&quot;</span><span class="p">]:</span>
        <span class="n">output_config</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="n">section</span><span class="p">]:</span>
            <span class="n">output_config</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">output_config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SAT&quot;</span><span class="p">:{},</span> <span class="s2">&quot;LAT&quot;</span><span class="p">:{}}</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SAT&quot;</span><span class="p">,</span> <span class="s2">&quot;LAT&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">telescope</span><span class="p">,</span> <span class="n">tubes</span> <span class="ow">in</span> <span class="n">telescopes</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output_config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">telescope</span><span class="p">]</span> <span class="o">=</span> <span class="n">toml_decoder</span><span class="o">.</span><span class="n">get_empty_inline_table</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tube_type</span> <span class="ow">in</span> <span class="n">tubes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">output_config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">telescope</span><span class="p">][</span><span class="n">tube_type</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">=</span> <span class="n">tube_type</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">tube_type</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span> <span class="s2">&quot;years&quot;</span><span class="p">:</span>
                    <span class="n">output_config</span><span class="p">[</span><span class="s2">&quot;telescopes&quot;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">telescope</span><span class="p">][</span><span class="n">tube_type</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tube_type</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">toml</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">output_config</span><span class="p">,</span> <span class="n">encoder</span><span class="o">=</span><span class="n">toml_encoder</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generate-a-TOML-configuration-file">Generate a TOML configuration file<a class="anchor-link" href="#Generate-a-TOML-configuration-file"> </a></h2><p>Click on the button to generate the TOML file and display it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">output_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;S4REFSIMTOOL_OUTPUT_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Generate TOML&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="c1"># &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39; or &#39;&#39;</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Click me&#39;</span><span class="p">,</span>
    <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;check&#39;</span>
<span class="p">)</span>
<span class="n">output_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;1px solid black&#39;</span><span class="p">})</span>

<span class="n">display</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">output_label</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
    
    <span class="n">toml_string</span> <span class="o">=</span> <span class="n">generate_toml</span><span class="p">()</span>
    <span class="n">md5sum</span> <span class="o">=</span> <span class="n">md5sum_string</span><span class="p">(</span><span class="n">toml_string</span><span class="p">)</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">md5sum</span>
    <span class="n">output_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">output_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">output_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;This exact CMB-S4 configuration has &lt;b&gt;already been executed&lt;/b&gt;&lt;br /&gt;&quot;</span> <span class="o">+</span> \
        <span class="n">f</span><span class="s2">&quot;&lt;a href=&#39;</span><span class="si">{output_location}</span><span class="s2">/output/</span><span class="si">{md5sum}</span><span class="s2">&#39; target=&#39;blank&#39;&gt;&lt;button class=&#39;p-Widget jupyter-widgets jupyter-button widget-button mod-success&#39;&gt;Access the maps &lt;/button&gt;&lt;/a&gt;&quot;</span>
    <span class="n">output_label</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="s2">&quot;&lt;p&gt;TOML file preview:&lt;/p&gt;&quot;</span>
    
    <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">toml_string</span><span class="p">)</span>

<span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_button_clicked</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">class</span> <span class="nc">OutputWidgetHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Custom logging handler sending logs to an output widget &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OutputWidgetHandler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
            <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;500px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;1px solid black&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overload of logging.Handler method &quot;&quot;&quot;</span>
        <span class="n">formatted_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="n">new_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;stdout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;output_type&#39;</span><span class="p">:</span> <span class="s1">&#39;stream&#39;</span><span class="p">,</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">formatted_record</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_output</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">show_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Show the logs &quot;&quot;&quot;</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear the current logs &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">root</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">OutputWidgetHandler</span><span class="p">()</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">  - [</span><span class="si">%(levelname)s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-the-simulation">Run the simulation<a class="anchor-link" href="#Run-the-simulation"> </a></h2><p>Generate the output maps</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s4_design_sim_tool.cli</span> <span class="k">import</span> <span class="n">md5sum_string</span><span class="p">,</span> <span class="n">S4RefSimTool</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">toml_filename</span><span class="p">,</span> <span class="n">md5sum</span><span class="p">):</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">toml_filename</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">S4RefSimTool</span><span class="p">(</span><span class="n">toml_filename</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">channels</span><span class="o">=</span><span class="s2">&quot;LFS1&quot;</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pole&quot;</span><span class="p">])</span>
    
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Create the wget script&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span> <span class="o">/</span> <span class="s2">&quot;download_all.sh&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">output_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;sh&quot;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;wget </span><span class="si">{output_location}</span><span class="s2">/</span><span class="si">{o}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Create the maps&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="c1"># &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39; or &#39;&#39;</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Click me&#39;</span><span class="p">,</span>
    <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;check&#39;</span>
<span class="p">)</span>

<span class="n">run_output_label</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">handler</span><span class="o">.</span><span class="n">clear_logs</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">run_button</span><span class="p">,</span> <span class="n">run_output_label</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_run_button_clicked</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="n">run_button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">toml_string</span> <span class="o">=</span> <span class="n">generate_toml</span><span class="p">()</span>
    <span class="n">md5sum</span> <span class="o">=</span> <span class="n">md5sum_string</span><span class="p">(</span><span class="n">toml_string</span><span class="p">)</span>

    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">md5sum</span>
    
    <span class="k">if</span> <span class="n">output_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This configuration has already been executed&quot;</span><span class="p">)</span>
        <span class="n">run_button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span>
    
    <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">toml_filename</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="s2">&quot;config.toml&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toml_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">toml_string</span><span class="p">)</span>
        
    <span class="n">run_output_label</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt; The simulation has been launched, see the logs below, access the TOML configuration file and the maps as they are created clicking on the button &lt;/p&gt;&quot;</span> <span class="o">+</span> \
        <span class="n">f</span><span class="s2">&quot;&lt;a href=&#39;</span><span class="si">{output_location}</span><span class="s2">/output/</span><span class="si">{md5sum}</span><span class="s2">&#39; target=&#39;blank&#39;&gt;&lt;button class=&#39;p-Widget jupyter-widgets jupyter-button widget-button mod-success&#39;&gt;Access the maps &lt;/button&gt;&lt;/a&gt;&quot;</span>
 
    <span class="n">run_simulation</span><span class="p">(</span><span class="n">toml_filename</span><span class="p">,</span> <span class="n">md5sum</span><span class="p">)</span>
    <span class="n">run_button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
    

<span class="n">run_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_run_button_clicked</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

